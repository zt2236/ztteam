### HTTP概述

#### web客户端和服务器

web资源都是存储在web服务器上的，web服务器使用的是http数据传输协议，所以也被成为http服务器。

客户端向服务器发送http请求，服务器会在http响应中回送所请求的数据

#### 资源

web服务器是web资源的宿主。最简单的web资源是web服务器中存储的静态文件。

资源不一定是静态文件

#### URI

URI被称为统一资源标识符，它就像因特网上的邮政地址一样，在世界范围内唯一标识并定位信息资源

URI有两种形式，分别称为url和urn

#### url

url被称为统一资源定位符，url可以明确的说明如何从一个精确，固定的位置获取资源。

大部分url遵循一种标准格式，格式包括三部分：

```
 第一部分被称为方案，说明了访问资源所使用的协议类型。通常都是HTTP协议（http://）。
第二部分给出了服务器的因特网网址（www.xxxx.com）。
其余部分指定了web服务器上的某个资源（/xxxxx/xxxx.gif）。
```

*现在，几乎所有的uri都是url。*

#### urn

urn作为特定内容的唯一名称使用，与目前的资源所在地无关。通过urn，可以用同一个名字通过多种网络访问协议来访问资源。urn仍然处于实验阶段，未大范围使用。

#### 方法

HTTP支持几种不同的请求命令，这些命令被称为HTTP方法。

常见方法

```
GET 					从服务器向客户端发送命名资源
PUT						将来自客户端的数据存储到一个命名的服务器资源中去
DELETE				从服务器删除命名资源
POST				   将客户端数据发送到一个服务器网关应用程序
HEAD					仅发送命名资源响应中的http首部
```

#### 报文

* 从web客户端发往web服务器的http报文称为请求报文。
* 从服务器发往客户端的称为响应报文。

#### TCP/IP协议

http是应用层协议。联网的细节都交给了通用、可靠的因特网传输协议TCP/IP。

TCP提供了：

* 无差错的数据传输;
* 按序传输（数据总是会按照发送的顺序到达）;
* 未分段的数据流（可以在任意时刻以任意尺寸将数据发送出去）;

TCP隐藏了各种网络和硬件的特点和弱点，使各种类型的计算机和网络都能够进行可靠的通信。

建立TCP连接后，客户端和服务器之间的报文交换就不会丢失，不会被破坏，也不会在接收时出现错序。

#### 连接、IP地址及端口号

IP地址就是互联网协议地址，互联网上的每一个网络和每一台主机分配一个逻辑地址

端口号相当于给所在网络或主机下的应用程序等编号，用来区分不同软件所使用的不同数据包

基本浏览器连接处理步骤：

1.浏览器从URL中解析出服务器的主机名;

2.浏览器将主机名转换成服务器的IP地址;

3.浏览器将端口号从URL中解析出来(如果没有，默认为80);

4.浏览器建立一条与web服务器的TCP连接;

5.浏览器向服务器发送http请求报文;

6.服务器向浏览器回送http响应报文;

7.关闭连接，浏览器显示文档。

#### web结构组件

代理：代理位于客户端和服务器之间，接收所有客户端的http请求，并将请求转发给服务器。它是web安全，应用集成以及行能优化的重要组成模块。

缓存：是一种特殊的http代理服务器，可将经过代理传送的常用文档复制保存起来。

网关：通常用于将http流量转换成其他的协议，网关接受请求时就好象自己是资源的源端服务器。

隧道：隧道建立起来之后，会在两条连接之间对原始数据进行盲转发的http应用程序。转发不会窥探数据。

Agent代理：是代表用户发起HTTP请求的客户端程序。所有发布web请求的应用程序都是HTTP Agent代理。

### URL

url最主要的三个部分

```
第一部分：url的文案（比如http）。可以告知web客户端怎样访问资源。
第二部分：服务器的位置，这部分告知web客户端资源位于何处
第三部分：资源路径,路径说明了请求的是服务器上哪个特定的本地资源
```

url语法：大部分url方案的url语法都建立在由9部分组成的通用格式上：

<scheme>://<user>:<password>@<host>:<port>/<path>;<params>?<query>#<frag>

http协议属于应用层，tcp协议在http协议的下层，属于传输层，ip协议属于网络层

#### TCP协议与UDP协议

TCP协议：

位于传输层，能把数据准确的传输给对方，数据总是会按照发送的顺序到达;可以在任意时刻以任意尺寸将数据发送出去。

tcp的字段：

```
1、SYN：同步连接序号，TCP SYN报文就是把这个标志设置为1，来请求建立连接；
2、 ACK：请求/应答状态。0为请求，1为应答；
3、 FIN：结束连线。如果FIN为0是结束连线请求，FIN为1表示结束连线；
4、 RST：连线复位，首先断开连接，然后重建；
5、 PSH：通知协议栈尽快把TCP数据提交给上层程序处理。
```



tcp三次握手：握手过程使用了tcp的标志——SYN和ACK

```
第一次握手：建立连接时客户端发送SYN包到服务器，并进入SYN_SEND状态，等待服务器确认。
第二次握手：服务器收到SYN包，必须确认客户端的SYN，同时自己也发送一个SYN包，即SYN+ACK包，此时服务器B进入SYN_RECV状态。
第三次握手：客户端A收到服务器B的SYN＋ACK包，向服务器B发送确认包ACK，此包发送完毕，完成三次握手。
注意：在握手过程中某个阶段莫名中断， TCP 协议会再次以相同的顺序发送相同的数据包。
```

![image](https://images0.cnblogs.com/blog/385532/201308/30193702-7287165c73e7440382207309e07fcbb5.png)



四次挥手：由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。先进行关闭的一方将执行主动关闭，而另一方被动关闭。

```
1.客户端发送一个FIN，用来关闭客户端到服务器的数据传送。
2.服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。
3.服务器关闭与客户端的连接，发送一个FIN给客户端。
4.客户端发回ACK报文确认，并将确认序号设置为收到序号加1。
```

![image](https://images0.cnblogs.com/blog/385532/201308/30193703-330b281cddc5439f99eb027ac1c9627c.png)

**TCP使用滑动窗口机制来进行流量控制：**

建立连接时，各端分配一个缓冲区用来存储接收的数据，并将缓冲区的尺寸发送给另一端。接收方发送的确认消息中包含了自己剩余的缓冲区尺寸。

*拥塞控制:*

防止过多的数据注入到网路中，这样可以使网络中的路由器或链路不至于阻塞。拥塞控制是一个全局性的过程，和流量控制不同，流量控制是点对点的控制。



UDP协议：

也叫无连接协议或透明协议，位于传输层。

tcp与udp区别：

```
1、TCP提供面向连接的传输，通信前要先建立连接（三次握手机制）； UDP提供无连接的传输，通信前不需要建立连接。
2、 TCP提供可靠的传输（有序，无差错，不丢失，不重复）； UDP提供不可靠的传输。
3、 TCP面向字节流的传输，因此它能将信息分割成组，并在接收端将其重组； UDP是面向数据报的传输，没有分组开销。
4、 TCP提供拥塞控制和流量控制机制； UDP不提供拥塞控制和流量控制机制。
```

### node.js搭建聊天室

参考链接：http://www.ydma.cn/courses/RbG4Be1Wn

在HTTP的网络协议栈可以分为4层，HTTPS在应用层下多了一个安全层TSL或SSL协议位于安全层

```
http协议属于应用层协议
tcp协议，也叫传输控制协议，位于传输层，提供面向连接的传输，udp协议也在传输层，提供无连接传输
ip协议位于网络层，简称网际协议
网络接口属于数据链路层
物理网络硬件，物理层
```



Socket=（IP地址：端口号）

```
1  将socket说成ip+port，ip是用来标识互联网中的一台主机的位置，而port是用来标识这台机器上的一个应用程序，ip地址是配置到网卡上的，而port是应用程序开启的，ip与port的绑定就标识了互联网中独一无二的一个应用程序
2  而程序的pid是同一台机器上不同进程或者线程的标识（Google Chrome会有多个PID)
3  Socket是应用层与TCP/IP协议族通信的中间软件抽象层，它是一组接口。在设计模式中，Socket其实就是一个门面模式，它把复杂的TCP/IP协议族隐藏在Socket接口后面，对用户来说，一组简单的接口就是全部，让Socket去组织数据，以符合指定的协议。
```





















